# 表格測試

<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

## 上傳
<div id="upload-file">
<input type="file" id="xlsxFile" accept=".xlsx" onchange="uploadFile()">
</div>

## 列印每頁標題與行數
<div id="worksheetsInfo"></div>

<script>
// Global variable
let workbook;

// Define helper functions
function uploadFile(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            resolve(new Uint8Array(e.target.result));
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
    });
}

function parseXLSX(data) {
    return XLSX.read(data, {type: 'array'});
}

async function uploadParseXLSX() {
    const xlsxFile = document.getElementById('xlsxFile').files[0];
    if (!xlsxFile) {
        alert('No file selected!');
        return;
    }

    const data = await uploadFile(xlsxFile);
    workbook = parseXLSX(data);

    return workbook.Sheets;  // Return sheets for the printInfo function
}

function printInfo(sheets) {
    const worksheetsInfoDiv = document.getElementById('worksheetsInfo');
    worksheetsInfoDiv.innerHTML = '';  // Clear previous content

    for (let sheetName in sheets) {
        const worksheet = sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
        const rowCount = jsonData.length;

        // Display the worksheet's title and row count
        const p = document.createElement('p');
        p.textContent = 'Title: ' + sheetName + ', Row Count: ' + rowCount;
        worksheetsInfoDiv.appendChild(p);
    }
}

async function uploadAndTest() {
    const sheets = await uploadParseXLSX();
    printInfo(sheets);
}

document.getElementById('xlsxFile').addEventListener('change', uploadAndTest);
</script>
